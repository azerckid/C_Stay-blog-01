# Phase 4 개선 사항 확인 방법

이 문서는 Phase 4에서 구현한 3가지 개선 사항의 확인 방법을 안내합니다.

## 1. Soft Delete 구현 확인

### 목표
트윗 삭제 시 실제로 데이터베이스에서 레코드가 삭제되지 않고 `deletedAt` 필드만 설정되는지 확인합니다.

### 확인 방법

#### 방법 1: 브라우저 개발자 도구 + 데이터베이스 확인

1. **트윗 삭제 테스트**
   - 로그인 후 홈 피드에서 본인이 작성한 트윗을 찾습니다
   - 트윗의 더보기 메뉴(···)에서 "삭제하기" 선택
   - 삭제 확인 다이얼로그에서 확인 클릭
   - Toast 알림으로 "트윗이 삭제되었습니다." 메시지 확인

2. **피드에서 확인**
   - 삭제한 트윗이 피드에서 사라졌는지 확인
   - 새로고침 후에도 삭제된 트윗이 나타나지 않는지 확인

3. **데이터베이스에서 확인 (Prisma Studio 사용)**
   ```bash
   npx prisma studio
   ```
   - Prisma Studio가 브라우저에서 열리면 `Tweet` 테이블 선택
   - 삭제한 트윗의 ID로 검색
   - 해당 트윗의 레코드가 여전히 존재하는지 확인
   - `deletedAt` 필드에 삭제 시각이 기록되어 있는지 확인 (NULL이 아님)
   - 다른 필드들(`content`, `userId` 등)은 그대로 유지되는지 확인

4. **삭제된 트윗 상세 페이지 접근 테스트**
   - 삭제한 트윗의 URL을 직접 입력 (예: `/tweet/{tweetId}`)
   - 404 에러 페이지 또는 "삭제된 트윗입니다." 메시지가 표시되는지 확인

#### 방법 2: SQL 쿼리로 확인 (Turso CLI)

```bash
# Turso CLI를 사용하여 데이터베이스에 접속
turso db shell nomad-ai

# 삭제된 트윗 확인
SELECT id, content, "deletedAt", "createdAt" FROM Tweet WHERE "deletedAt" IS NOT NULL;

# 삭제되지 않은 트윗 확인 (deletedAt이 NULL인 것만)
SELECT id, content, "deletedAt" FROM Tweet WHERE "deletedAt" IS NULL;
```

#### 예상 결과
- ✅ 트윗 삭제 후 피드에서 사라짐
- ✅ 데이터베이스에서 레코드는 유지되고 `deletedAt` 필드만 설정됨
- ✅ 삭제된 트윗 상세 페이지 접근 시 404 에러
- ✅ 삭제된 트윗 수정 시도 시 에러 메시지 표시

---

## 2. 삭제/수정 후 피드 갱신 개선 확인

### 목표
트윗 삭제 또는 수정 후 피드가 자동으로 갱신되어 변경사항이 즉시 반영되는지 확인합니다.

### 확인 방법

#### 방법 1: 트윗 삭제 후 피드 갱신 확인

1. **준비**
   - 홈 피드에 여러 트윗이 표시되는 상태로 준비
   - 브라우저 개발자 도구 열기 (F12)
   - Network 탭 열기

2. **트윗 삭제 테스트**
   - 본인이 작성한 트윗을 삭제
   - Toast 알림으로 "트윗이 삭제되었습니다." 메시지 확인

3. **피드 갱신 확인**
   - 삭제한 트윗이 **새로고침 없이** 즉시 피드에서 사라졌는지 확인
   - Network 탭에서 자동으로 새 요청이 발생했는지 확인 (loader 재호출)
   - 페이지 전체 새로고침이 아닌 부분 갱신인지 확인

#### 방법 2: 트윗 수정 후 피드 갱신 확인

1. **준비**
   - 본인이 작성한 트윗 찾기
   - 브라우저 개발자 도구 Network 탭 열기

2. **트윗 수정 테스트**
   - 트윗의 더보기 메뉴(···)에서 "수정하기" 선택
   - 다이얼로그에서 내용 수정 (예: "수정된 내용입니다")
   - "수정하기" 버튼 클릭
   - Toast 알림으로 "트윗이 수정되었습니다." 메시지 확인
   - 다이얼로그가 자동으로 닫히는지 확인

3. **피드 갱신 확인**
   - 수정된 트윗의 내용이 **새로고침 없이** 즉시 피드에 반영되었는지 확인
   - Network 탭에서 loader 재호출이 발생했는지 확인
   - 피드에서 수정된 내용이 올바르게 표시되는지 확인

#### 방법 3: 네트워크 요청 확인

1. **브라우저 개발자 도구 Network 탭에서 확인**
   - 삭제/수정 액션 후 자동으로 `/` (홈 피드) loader가 재호출되는지 확인
   - 불필요한 중복 요청이 발생하지 않는지 확인
   - 요청이 한 번만 발생하는지 확인

#### 예상 결과
- ✅ 트윗 삭제 후 새로고침 없이 피드에서 즉시 제거됨
- ✅ 트윗 수정 후 새로고침 없이 피드에서 즉시 업데이트됨
- ✅ Network 탭에서 loader 재호출 확인
- ✅ 불필요한 중복 요청 없음

---

## 3. 페이지네이션 구현 확인

### 목표
무한 스크롤이 올바르게 동작하여 스크롤 하단에 도달하면 추가 트윗이 자동으로 로드되는지 확인합니다.

### 확인 방법

#### 방법 1: 무한 스크롤 기본 동작 확인

1. **준비**
   - 홈 피드에 20개 이상의 트윗이 있어야 함 (없으면 테스트용 트윗 여러 개 작성)
   - 브라우저 개발자 도구 열기 (F12)
   - Network 탭 열기

2. **초기 로딩 확인**
   - 홈 페이지 접속 시 처음에 20개의 트윗만 표시되는지 확인
   - Network 탭에서 초기 loader 요청 확인 (URL: `/`)

3. **스크롤 다운 테스트**
   - 페이지를 하단으로 스크롤
   - 화면 하단 근처에 도달하면 자동으로 추가 트윗이 로드되는지 확인
   - 로딩 스피너가 잠시 표시되는지 확인
   - 추가 트윗이 기존 트윗 아래에 추가되는지 확인

4. **추가 요청 확인**
   - Network 탭에서 `/?cursor=...` 형식의 새로운 요청이 발생하는지 확인
   - 커서 값이 이전 트윗의 `createdAt` 타임스탬프인지 확인

#### 방법 2: URL 쿼리 파라미터 확인

1. **수동 커서 테스트**
   - 브라우저 주소창에 직접 입력: `/?cursor=2024-01-01T00:00:00.000Z`
   - 해당 커서 이후의 트윗만 로드되는지 확인
   - 정확히 20개의 트윗이 표시되는지 확인

#### 방법 3: 로딩 상태 확인

1. **로딩 스피너 확인**
   - 스크롤 하단에 도달했을 때 로딩 스피너가 표시되는지 확인
   - 트윗이 로드되는 동안 스피너가 유지되는지 확인
   - 로드가 완료되면 스피너가 사라지는지 확인

2. **더 이상 로드할 트윗이 없을 때**
   - 모든 트윗을 로드한 후 스크롤해도 추가 요청이 발생하지 않는지 확인
   - 로딩 스피너가 더 이상 표시되지 않는지 확인

#### 방법 4: 성능 확인

1. **초기 로딩 시간**
   - 페이지 로드 시 20개만 로드되므로 초기 로딩이 빠른지 확인
   - 초기 HTML 응답 크기가 적절한지 확인 (Network 탭에서)

2. **추가 로딩 시간**
   - 스크롤 시 추가 트윗 로드 시간이 적절한지 확인 (1-2초 이내 권장)

#### 방법 5: 데이터 일관성 확인

1. **중복 없음 확인**
   - 같은 트윗이 중복으로 표시되지 않는지 확인
   - 스크롤 후 다시 위로 올라갔다가 내려와도 트윗이 중복되지 않는지 확인

2. **정렬 확인**
   - 트윗이 최신순으로 올바르게 정렬되어 있는지 확인
   - 추가 로드된 트윗도 시간순으로 올바르게 정렬되는지 확인

#### 예상 결과
- ✅ 초기 로딩 시 20개의 트윗만 표시됨
- ✅ 스크롤 하단 도달 시 추가 트윗 자동 로드
- ✅ 로딩 스피너가 적절히 표시됨
- ✅ Network 탭에서 `/?cursor=...` 요청 확인
- ✅ 모든 트윗 로드 후 추가 요청 없음
- ✅ 트윗 중복 없음
- ✅ 최신순 정렬 유지

---

## 종합 테스트 시나리오

### 전체 플로우 테스트

1. **시나리오 1: 트윗 작성 → 삭제 → 확인**
   - 새 트윗 작성
   - 작성한 트윗 삭제
   - 데이터베이스에서 `deletedAt` 확인
   - 피드에서 즉시 제거 확인

2. **시나리오 2: 트윗 작성 → 수정 → 확인**
   - 새 트윗 작성
   - 트윗 수정
   - 피드에서 즉시 업데이트 확인
   - 수정된 내용이 올바르게 표시되는지 확인

3. **시나리오 3: 페이지네이션 → 삭제 → 갱신**
   - 여러 페이지 스크롤하여 트윗 로드
   - 중간에 있는 트윗 삭제
   - 피드에서 즉시 제거 확인
   - 페이지네이션이 올바르게 동작하는지 확인

---

## 문제 해결

### Soft Delete가 작동하지 않는 경우
- Prisma Studio에서 `deletedAt` 필드가 실제로 업데이트되었는지 확인
- 서버 로그에서 DELETE action이 올바르게 실행되었는지 확인
- TypeScript 컴파일 오류가 없는지 확인 (`npm run typecheck`)

### 피드 갱신이 작동하지 않는 경우
- 브라우저 개발자 도구 Console 탭에서 에러 확인
- `useRevalidator`가 올바르게 import되었는지 확인
- Network 탭에서 loader 재호출이 발생하는지 확인

### 페이지네이션이 작동하지 않는 경우
- 브라우저 개발자 도구 Console 탭에서 에러 확인
- Intersection Observer가 지원되는 브라우저인지 확인
- Network 탭에서 `/?cursor=...` 요청이 발생하는지 확인
- `nextCursor`가 올바르게 설정되었는지 확인 (loader에서 반환되는 값)

